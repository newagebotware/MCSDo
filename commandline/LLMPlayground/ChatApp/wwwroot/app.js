(()=>{document.addEventListener("DOMContentLoaded",()=>{let l=document.getElementById("userInput"),n=document.getElementById("messageInput"),d=document.getElementById("sendButton"),a=document.getElementById("messages");function i(r){return r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function s(){let r=new EventSource("/api/chat/stream");return r.onmessage=t=>{let o=JSON.parse(t.data),e=document.createElement("div");e.className="message",e.innerHTML=`<strong>${i(o.user||"")}</strong> (${new Date(o.timestamp).toLocaleTimeString()}): ${i(o.message||"")}`,a.appendChild(e),a.scrollTop=a.scrollHeight},r.onerror=()=>{console.error("SSE error, reconnecting in 5 seconds..."),r.close(),setTimeout(s,5e3)},r}fetch("/api/chat/transcript").then(r=>r.json()).then(r=>{r.forEach(t=>{let o=document.createElement("div");o.className="message",o.innerHTML=`<strong>${i(t.user||"")}</strong> (${new Date(t.timestamp).toLocaleTimeString()}): ${i(t.message||"")}`,a.appendChild(o)}),a.scrollTop=a.scrollHeight}).catch(r=>console.error("Error loading transcript:",r)),s(),d.addEventListener("click",async()=>{let r=l.value.trim(),t=n.value.trim();if(!r||!t){alert("Please enter both a user name and message.");return}let o={user:r,message:t};try{(await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).ok?n.value="":alert("Failed to send message.")}catch(e){console.error("Error sending message:",e),alert("Error sending message.")}})});})();
